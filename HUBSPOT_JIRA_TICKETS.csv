Summary,Type,Priority,Story Points,Component,Description,Acceptance Criteria
Fix HubSpot API Payload Format Bug,Task,Highest,2,HubSpot Integration,"The HubSpot v3 API requires a different payload structure. Location: lib/hubspot.ts lines 144-149, 190-196. Current (WRONG): properties.map(p => ({objectTypeId: '0-1', name: p.property, value: p.value})) Should be (CORRECT): properties.reduce((acc, p) => ({...acc, [p.property]: p.value}), {})","[*] Fix API payload format in createContact() [*] Fix API payload format in updateContact() [*] Test with sample contact data [*] Verify API responses return 201/200 (not 400)"
Fix HubSpot Contact Search Logic,Task,Highest,2,HubSpot Integration,"Current contact search loads ALL contacts (inefficient, hits rate limits). Should use HubSpot v3 search API with email filter. Location: lib/hubspot.ts lines 95-128. Replace GET /crm/v3/objects/contacts?limit=1&after=0 with POST /crm/v3/objects/contacts/search with email filter.","[*] Implement search API endpoint call [*] Verify single contact found by email [*] Test with non-existent email (returns empty) [*] Add error handling for malformed emails"
Add Timeout and Retry Logic to HubSpot Client,Task,High,3,HubSpot Integration,"HubSpot API calls can hang indefinitely. Add 10-second timeout and exponential backoff retry (2s, 4s, 8s). Create helper function retryWithBackoff in lib/hubspot-retry.ts with Promise.race for timeout and retry loop.","[*] Create retry helper function [*] Wrap all HubSpot API calls with retry [*] Test timeout behavior (verify <10s response) [*] Test retry on transient failures [*] Add error logging with HubSpot error codes"
Add HUBSPOT_API_KEY Environment Variable,Task,Critical,0.5,Infrastructure,"HubSpot integration requires API key in environment. Update .env.local, lib/hubspot.ts, and docker-compose.yml. Files: .env.local (add HUBSPOT_API_KEY), lib/hubspot.ts (load from env), docker-compose.yml (pass env var).","[*] Add HUBSPOT_API_KEY to .env.local [*] Update docker-compose to include env var [*] Verify API key is loaded in lib/hubspot.ts [*] Confirm no API key commits"
Create HubSpot Integration Test Endpoint,Story,High,2,API,"Create endpoint GET /api/hubspot/test to validate HubSpot integration works end-to-end. Returns HTTP 200 on success with testContact object containing email, firstName, lastName, hubspotId, syncedAt. Verify contact syncs to PostgreSQL. Test with invalid API key (returns 401). Clean up test contacts after.","[*] Create /api/hubspot/test endpoint [*] Test creates contact in HubSpot [*] Verify contact syncs to PostgreSQL [*] Return appropriate success response [*] Test with invalid API key (returns 401) [*] Clean up test contacts"
Add Environment Variable for HubSpot Setup,Task,High,1,Infrastructure,"Document and verify all HubSpot-related environment variables are configured. Required: HUBSPOT_API_KEY, HUBSPOT_PORTAL_ID (optional), DATABASE_URL (existing), NODE_ENV (production/development). Verify environment variable loading and document requirements.","[*] Verify HUBSPOT_API_KEY is set in .env.local [*] Verify DATABASE_URL is accessible [*] Test environment variable loading [*] Document all required vars in README"
Create HubSpot Unit Test Suite,Task,High,4,Testing,"Create comprehensive unit tests for HubSpot client (target: ≥80% coverage). File: __tests__/hubspot.test.ts. Tests: createContact (new/existing/invalid), updateContact, searchContact, retryLogic, errorHandling (network/400/429/timeout), integration (form → HubSpot). Mock HubSpot API responses.","[*] Create test file with all test cases [*] Achieve ≥80% code coverage [*] All tests passing (npm test) [*] Mock HubSpot API responses [*] Test both success and failure paths"
Create HubSpot Integration Tests,Task,High,3,Testing,"Integration tests using HubSpot sandbox account. Tests: end-to-end form submission, verify contact in HubSpot, database persistence, analytics incrementing, error recovery (API down, invalid key). Document test procedures for manual verification.","[*] Create integration test suite [*] Test against HubSpot sandbox [*] Verify all data fields synced [*] Test error scenarios [*] Document test procedures"
Create HubSpot Stats Dashboard,Story,Medium,3,Monitoring,"Dashboard showing HubSpot sync health. Endpoint: GET /api/admin/hubspot/stats. Returns: syncStats (totalSynced, successRate, failedSyncs, lastSync, averageTime), queueStats (pending, failed, retrying), errors array. Include admin auth check. Optional: email alerts for >10% failure.","[*] Create stats endpoint [*] Query sync statistics from database [*] Calculate success rate percentage [*] List failed syncs with error details [*] Add admin authentication check"
Create HubSpot Background Sync Queue,Task,Medium,3,Infrastructure,"Retry failed syncs automatically every 15 minutes. File: lib/hubspot-queue.ts. Query hubspot_sync_log for failed entries. Retry with exponential backoff (max 24 hours). Update retry count and timestamp. Log results. Optional: alert on >3 failures.","[*] Create queue system [*] Implement retry logic with max attempts [*] Add cron job (15 minute interval) [*] Test retry with failure injection [*] Verify database updates [*] Monitor logs"
Refactor HubSpot Client to Modular TypeScript Library,Task,High,5,HubSpot Integration,"Refactor lib/hubspot.ts into modular structure: lib/hubspot/client.ts (main), contacts.ts (operations), companies.ts, deals.ts, types.ts (TypeScript types), config.ts. Create @aurigraph/hubspot npm package. Maintain backward compatibility. Add JSDoc comments.","[*] Create modular file structure [*] Move contact operations to contacts.ts [*] Create TypeScript type definitions [*] Add comprehensive JSDoc [*] Maintain backward compatibility [*] Test all exports"
Implement HubSpot Java Client with Quarkus,Task,High,6,HubSpot Integration,"Implement Java client for V12 platform using Quarkus + Mutiny (reactive). File: io.aurigraph.v12.crm.HubSpotClientImpl. Use SmallRye Fault Tolerance (@CircuitBreaker, @Retry, @Timeout, @Fallback). Support async/await patterns. Match TypeScript API signatures.","[*] Create HubSpotClientImpl.java [*] Implement Mutiny Uni/Multi patterns [*] Add SmallRye Fault Tolerance decorators [*] Create service layer (HubSpotContactService) [*] Unit tests with ≥80% coverage"
Create Unified HubSpot API Contract (OpenAPI 3.1),Task,Medium,3,Architecture,"Design shared OpenAPI 3.1 contract defining HubSpot integration API. Document: /schemas/hubspot-api.openapi.yaml. Include: Contact operations, error responses, rate limiting, authentication. Both TypeScript and Java implement this contract.","[*] Create OpenAPI 3.1 specification [*] Document all endpoints [*] Include error schemas [*] Define authentication [*] Validate with Swagger tools"
Implement HubSpot Java REST Resource,Story,High,4,API,"Create JAX-RS REST endpoints for V12 platform. File: io.aurigraph.v12.crm.resource.CRMResource. Endpoints: POST /api/v12/crm/contacts (create), PUT (update), GET (search). Integrate with HubSpotClientImpl. Add request validation and error handling.","[*] Create CRMResource class [*] Implement all endpoints [*] Add request validation [*] Handle errors gracefully [*] Integration tests with database"
Add HubSpot Metrics to Prometheus,Task,Medium,2,Monitoring,"Expose HubSpot sync metrics to Prometheus. Metrics: sync_success_total, sync_failure_total, sync_duration_seconds, retry_count, queue_size. Both TypeScript (Prom client) and Java (Micrometer) implementations.","[*] Add Prometheus metrics library [*] Implement sync counters [*] Track sync duration [*] Expose /metrics endpoint [*] Test metrics collection"
Setup Grafana Dashboards for HubSpot Monitoring,Task,Medium,3,Monitoring,"Create Grafana dashboards showing HubSpot sync health. Dashboard: sync success rate, failures over time, average sync time, queue size, error distribution. Add alerts for >10% failure rate.","[*] Create Grafana dashboard [*] Add success rate panel [*] Add failure trend panel [*] Add queue size panel [*] Configure alert rules"
Configure Email Alerts for HubSpot Failures,Task,Medium,2,Alerting,"Setup email notifications for HubSpot sync failures. Send alert when: >10% failure rate, queue backlog >100, sync failures persist >1 hour. Use SendGrid or SMTP. Recipients: admin@aurigraph.io. Test with failure injection.","[*] Setup SendGrid/SMTP [*] Create alert template [*] Implement failure detection [*] Test with injected failures [*] Document alert procedures"
Write HubSpot Integration Documentation,Task,Low,2,Documentation,"Document HubSpot integration for developers. Create: architecture diagram, API reference, setup guide, troubleshooting. Include: environment variables, database schema, error handling, monitoring. Both TypeScript and Java implementations.","[*] Create architecture diagrams [*] Write API reference [*] Create setup guide [*] Document error codes [*] Add troubleshooting section"
Deploy HubSpot Integration to Production,Story,Critical,3,Deployment,"Deploy HubSpot MVP to production. Steps: 1) Verify all tests pass 2) Deploy containers 3) Run /api/hubspot/test 4) Monitor syncs 24 hours 5) Verify 95%+ success rate. Rollback plan: remove HUBSPOT_API_KEY from env.","[*] Verify tests passing [*] Deploy to staging first [*] Run smoke tests [*] Deploy to production [*] Monitor 24 hours [*] Document deployment"
